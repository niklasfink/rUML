!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./matchesonscrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],t):t(CodeMirror)}(function(t){"use strict";function e(t){"object"==typeof t&&(this.minChars=t.minChars,this.style=t.style,this.showToken=t.showToken,this.delay=t.delay,this.wordsOnly=t.wordsOnly,this.annotateScrollbar=t.annotateScrollbar),null==this.style&&(this.style=c),null==this.minChars&&(this.minChars=h),null==this.delay&&(this.delay=u),null==this.wordsOnly&&(this.wordsOnly=g),this.overlay=this.timeout=null,this.matchesonscroll=null}function r(t){var e=t.state.matchHighlighter;clearTimeout(e.timeout),e.timeout=setTimeout(function(){o(t)},e.delay)}function n(t,e,r,n){var i=t.state.matchHighlighter;if(t.addOverlay(i.overlay=s(e,r,n)),i.annotateScrollbar){var o=r?new RegExp("\\b"+e+"\\b"):e;i.matchesonscroll=t.showMatchesOnScrollbar(o,!0,{className:"CodeMirror-selection-highlight-scrollbar"})}}function i(t){var e=t.state.matchHighlighter;e.overlay&&(t.removeOverlay(e.overlay),e.overlay=null,e.annotateScrollbar&&(e.matchesonscroll.clear(),e.matchesonscroll=null))}function o(t){t.operation(function(){var e=t.state.matchHighlighter;if(i(t),!t.somethingSelected()&&e.showToken){for(var r=e.showToken===!0?/[\w$]/:e.showToken,o=t.getCursor(),a=t.getLine(o.line),s=o.ch,h=s;s&&r.test(a.charAt(s-1));)--s;for(;h<a.length&&r.test(a.charAt(h));)++h;return void(h>s&&n(t,a.slice(s,h),r,e.style))}var c=t.getCursor("from"),u=t.getCursor("to");if(c.line==u.line&&(!e.wordsOnly||l(t,c,u))){var g=t.getRange(c,u).replace(/^\s+|\s+$/g,"");g.length>=e.minChars&&n(t,g,!1,e.style)}})}function l(t,e,r){var n=t.getRange(e,r);if(null!==n.match(/^\w+$/)){if(e.ch>0){var i={line:e.line,ch:e.ch-1},o=t.getRange(i,e);if(null===o.match(/\W/))return!1}if(r.ch<t.getLine(e.line).length){var i={line:r.line,ch:r.ch+1},o=t.getRange(r,i);if(null===o.match(/\W/))return!1}return!0}return!1}function a(t,e){return!(t.start&&e.test(t.string.charAt(t.start-1))||t.pos!=t.string.length&&e.test(t.string.charAt(t.pos)))}function s(t,e,r){return{token:function(n){return!n.match(t)||e&&!a(n,e)?(n.next(),void(n.skipTo(t.charAt(0))||n.skipToEnd())):r}}}var h=2,c="matchhighlight",u=100,g=!1;t.defineOption("highlightSelectionMatches",!1,function(n,l,a){a&&a!=t.Init&&(i(n),clearTimeout(n.state.matchHighlighter.timeout),n.state.matchHighlighter=null,n.off("cursorActivity",r)),l&&(n.state.matchHighlighter=new e(l),o(n),n.on("cursorActivity",r))})});